**-- Use an admin role**

USE ROLE ACCOUNTADMIN;

**-- Create the transform role**

CREATE ROLE IF NOT EXISTS TRANSFORM;

GRANT ROLE TRANSFORM TO ROLE SYSADMIN;

**-- Create the default warehouse if necessary**

CREATE WAREHOUSE IF NOT EXISTS COMPUTE_WH;

GRANT OPERATE ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

**-- Create the dbt user and assign to role**

CREATE USER IF NOT EXISTS dbt 
PASSWORD='dbtPassword123' 
LOGIN_NAME='dbt' 
MUST_CHANGE_PASSWORD=FALSE 
DEFAULT_WAREHOUSE='COMPUTE_WH' 
DEFAULT_ROLE=TRANSFORM 
DEFAULT_NAMESPACE='RAW.AIRBNB' 
COMMENT='DBT user used for data transformation'; 

GRANT ROLE TRANSFORM to USER dbt;

**-- Create our database and schemas**

CREATE DATABASE IF NOT EXISTS RAW;

CREATE SCHEMA IF NOT EXISTS RAW.AIRBNB;

CREATE DATABASE IF NOT EXISTS STG;

CREATE SCHEMA IF NOT EXISTS STG.AIRBNB;

CREATE DATABASE IF NOT EXISTS INT;

CREATE SCHEMA IF NOT EXISTS INT.AIRBNB;

CREATE DATABASE IF NOT EXISTS DWH;

CREATE SCHEMA IF NOT EXISTS DWH.AIRBNB;

**-- Set up permissions to role transform**

**For Database RAW**

GRANT ALL ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

GRANT ALL ON DATABASE RAW to ROLE TRANSFORM;

GRANT ALL ON ALL SCHEMAS IN DATABASE RAW to ROLE TRANSFORM;

GRANT ALL ON FUTURE SCHEMAS IN DATABASE RAW to ROLE TRANSFORM;

GRANT ALL ON ALL TABLES IN SCHEMA RAW.AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA RAW.AIRBNB to ROLE TRANSFORM;

**For Database STG**

GRANT ALL ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

GRANT ALL ON DATABASE STG to ROLE TRANSFORM;

GRANT ALL ON ALL SCHEMAS IN DATABASE STG to ROLE TRANSFORM;

GRANT ALL ON FUTURE SCHEMAS IN DATABASE STG to ROLE TRANSFORM;

GRANT ALL ON ALL TABLES IN SCHEMA STG.AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA STG.AIRBNB to ROLE TRANSFORM;

**For Database INT**

GRANT ALL ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

GRANT ALL ON DATABASE INT to ROLE TRANSFORM;

GRANT ALL ON ALL SCHEMAS IN DATABASE INT to ROLE TRANSFORM;

GRANT ALL ON FUTURE SCHEMAS IN DATABASE INT to ROLE TRANSFORM;

GRANT ALL ON ALL TABLES IN SCHEMA INT.AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA INT.AIRBNB to ROLE TRANSFORM;

**For Database DWH**

GRANT ALL ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

GRANT ALL ON DATABASE DWH to ROLE TRANSFORM;

GRANT ALL ON ALL SCHEMAS IN DATABASE DWH to ROLE TRANSFORM;

GRANT ALL ON FUTURE SCHEMAS IN DATABASE DWH to ROLE TRANSFORM;

GRANT ALL ON ALL TABLES IN SCHEMA DWH.AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA DWH.AIRBNB to ROLE TRANSFORM;
